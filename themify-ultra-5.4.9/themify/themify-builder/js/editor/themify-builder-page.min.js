'use strict';(l=>{let b;window.ThemifyBuilderPage={container:null,layout_lists:null,spinner:null,layouts_loaded:!1,loadCSS:function(){Object.keys(tbBuilderPage.css).forEach(function(a){if(!document.getElementById(a+"-css")){const c=document.createElement("link");c.setAttribute("rel","stylesheet");c.setAttribute("href",tbBuilderPage.css[a]);c.setAttribute("id",a+"-css");document.head.appendChild(c)}})},loadLayoutsList:function(){l.ajax({type:"POST",url:tbBuilderPage.ajaxurl,dataType:"json",data:{action:"tb_load_predesigned_layouts",
nonce:tbBuilderPage.nonce,src:tbBuilderPage.paths.layouts_index},success(a){b.layouts_loaded=!0;a=JSON.parse(a.data);b.renderLayouts(a);b.spinner.style.display="none"},error(){}})},publishPage:function(a){return l.ajax({type:"POST",url:tbBuilderPage.ajaxurl,data:{_ajax_nonce:tbBuilderPage.nonce,action:"tb_builder_page_publish",title:a.title,layout:a.layout,parent:a.parent},success:function(c){c.success?window.location=c.data:(console&&console.log(c),b.hidePanel())},complete:function(){b.spinner.style.display=
"none"}})},renderLayouts:function(a,c){c={};const h=document.createDocumentFragment();document.createDocumentFragment();const k=b.container.querySelector(".tbbp_search_icon svg"),q=b.container.querySelector(".tbbp_category ul");for(let d=0,r=a.length;d<r;++d){var g=document.createElement("li"),e=document.createElement("div"),f=document.createElement("div");let n=document.createElement("img"),p=document.createElement("div");g.dataset.category=a[d].category;e.className="tbbp_preview";e.dataset.id=a[d].id;
e.dataset.slug=a[d].slug;f.className="tbbp_thumbnail";n.src=a[d].thumbnail;n.alt=a[d].title;n.title=a[d].title;p.className="tbbp_layout_title";p.textContent=a[d].title;f.appendChild(n);e.appendChild(f);e.appendChild(p);void 0!==a[d].url&&(f=document.createElement("a"),f.className="tbbp_preview_link",f.href=a[d].url,f.target="_blank",f.title="Preview",f.appendChild(k.cloneNode(!0)),e.appendChild(f));g.appendChild(e);h.appendChild(g);if(a[d].category){g=String(a[d].category).split(",");for(let m=0,
t=g.length;m<t;++m)""!==g[m]&&1!==c[g[m]]&&(e=document.createElement("li"),e.textContent=g[m],q.appendChild(e),c[g[m]]=1)}}b.layout_lists.appendChild(h)},init:function(){b.layout_lists.addEventListener("click",function(a){if(a.target.closest("li")){let c;null==(c=b.layout_lists.querySelector(".selected"))||c.classList.remove("selected");a.target.closest("li").classList.add("selected")}});b.container.querySelector(".tbbp_close").addEventListener("click",function(){b.hidePanel()});b.container.querySelector(".tbbp_search_container input").addEventListener("keyup",
function(){let a=this.value.trim(),c=l(b.layout_lists).find("li");""===a?c.show():c.hide().find(".tbbp_layout_title").filter(function(){return(new RegExp(a,"i")).test(l(this).text())}).closest("li").show()});b.container.addEventListener("submit",function(a){const c=b.container.querySelector(".tbbp_title input").value;if(""!==c){a.preventDefault();b.spinner.style.display="block";a=b.layout_lists.querySelector(".selected > div").dataset.slug;var h=b.container.querySelector(".tbbp_parent select").value;
""===a?b.publishPage({title:c,parent:h}):l.get(tbBuilderPage.paths.layout_template.replace("{SLUG}",a),null,null,"text").done(k=>{k=JSON.parse(k);b.publishPage({title:c,parent:h,layout:k})})}});b.container.querySelector(".tbbp_category ul").addEventListener("click",a=>{if("LI"===a.target.tagName){var c=l(b.layout_lists).find("li"),h=a.target.textContent,k=a.target.closest(".tbbp_category").querySelector(".tbbp_category_label");k.blur();k.textContent=h;a.target.classList.contains("all")?c.show():c.hide().filter('[data-category*="'+
h+'"]').show()}})},loadPanel:function(){return null===b.container?l.ajax({type:"POST",url:tbBuilderPage.ajaxurl,data:{_ajax_nonce:tbBuilderPage.nonce,action:"tb_builder_page"},success:function(a){let c=document.createElement("div");c.innerHTML=a;b.container=c.firstChild;b.layout_lists=b.container.getElementsByClassName("tbbp_layout_lists")[0];Themify.body[0].appendChild(b.container)}}):new Promise(a=>{a()})},showPanel:function(){b.container.style.display="block"},hidePanel:function(){b.container.style.display=
"none"},run:function(){b=this;b.loadCSS();b.loadPanel().then(function(){b.showPanel();b.layouts_loaded||b.loadLayoutsList();b.init()})}}})(jQuery);
