var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.findInternal=function(e,m,k){e instanceof String&&(e=String(e));for(var p=e.length,g=0;g<p;g++){var v=e[g];if(m.call(k,v,g,e))return{i:g,v:v}}return{i:-1,v:void 0}};$jscomp.defineProperty="function"==typeof Object.defineProperties?Object.defineProperty:function(e,m,k){e!=Array.prototype&&e!=Object.prototype&&(e[m]=k.value)};$jscomp.getGlobal=function(e){return"undefined"!=typeof window&&window===e?e:"undefined"!=typeof global&&null!=global?global:e};
$jscomp.global=$jscomp.getGlobal(this);$jscomp.polyfill=function(e,m,k,p){if(m){k=$jscomp.global;e=e.split(".");for(p=0;p<e.length-1;p++){var g=e[p];g in k||(k[g]={});k=k[g]}e=e[e.length-1];p=k[e];m=m(p);m!=p&&null!=m&&$jscomp.defineProperty(k,e,{configurable:!0,writable:!0,value:m})}};$jscomp.polyfill("Array.prototype.find",function(e){return e?e:function(e,k){return $jscomp.findInternal(this,e,k).v}},"es6-impl","es3");var TB_InlineEdit;
(function(e,m,k,p,g){var v,y,B=0,C,z,F,D,x=null,r,E,q,w,A,G=function(a){A&&D&&(a=a.closest(".module_row"),g.hasChanged=!0,g.undoManager.push(a.data("cid"),D,a,"row"),D=null)};TB_InlineEdit={is_editable:!1,is_active:!1,toolbar:null,tinymce:null,el:null,init:function(){Themify.LoadCss(e("#dashicons-css",top_iframe).prop("href"),!1);e(".themify_builder_content").on("click","[contenteditable]",this.enable);var a=e.ui.sortable.prototype._mouseDown,b=e(k);e.ui.sortable.prototype._mouseDown=function(c,f,
d){if(1===c.which)if(0<e(c.target).closest("[contenteditable]").length){var h=this;b.one("mousemove",function(b){1===b.which&&a.apply(h,[c,f,d])})}else a.apply(this,[c,f,d])};this.toolbar=e("#tb_editor");E=this.toolbar.on("click",".tb_editor_action",this._actionClicked).find("#tb_editor_link_edit");ThemifyBuilderCommon.Lightbox.$lightbox.on("themify_opened_lightbox",function(a){this.is_active&&(v=null,this.disable())}.bind(this))},activate:function(a){"false"!==a.prop("contenteditable")&&(a=a.find('[contenteditable="false"]').first());
0<a.length&&(z=!0,a.trigger("click"),z=!1,g.activeModel.unset("is_new",{silent:!0}),g.activeModel=null)},selectStart:function(a){"selectstart"===a.type?(v=!0,e(this).off("keyup",TB_InlineEdit._selection).on("keyup",TB_InlineEdit._selection)):1===a.which&&(v=!0,y=a.pageY,e(k).one("mouseup",function(a){y>a.pageY&&(y=a.pageY);TB_InlineEdit._selection()}))},enable:function(a){a.stopImmediatePropagation();a.preventDefault();v=null;!z&&g.activeModel&&g.Forms.saveComponent(a);var b=e(this),c=TB_InlineEdit,
f=b.closest(".active_module"),d=f.data("cid");if(d===F&&1===B)c.disable();else if("false"==this.contentEditable){B=0;A&&c.el&&(c.save(),G(c.el));c.el&&(c.el[0].contentEditable=!1,c.el.closest(".active_module").removeClass("tb_editor_on"));e("#tb_editor_carret").remove();D=ThemifyBuilderCommon.clone(f.closest(".module_row"));f[0].classList.add("tb_editor_on");c.is_editable=this.classList.contains("tb_editor_enable");if(c.is_editable&&"A"!==a.target.nodeName&&"button"!==a.target.nodeName&&0===e(a.target).closest("a").length){var h=
m.getSelection();if(0<h.rangeCount){var t=k.createElement("span");t.id="tb_editor_carret";h.getRangeAt(0).cloneRange().surroundContents(t)}}F=d;this.contentEditable=c.is_active=!0;c.is_editable||b.focus();A=!1;c.remove();var l=z;g.undoManager.disable();setTimeout(function(){if(c.is_active){B=0;c.el=b;q=b.closest(".themify_builder_slider");if(0<q.length){if(q.trigger("pause",!0),q.data("events").mousedown){w=q.data("events").mousedown;for(var d=0,H=w.length;d<H;++d)q.unbind("mousedown",w[d].handler)}}else q=
w=null;c.is_editable?(d=e.extend({},!0,tinyMCEPreInit.mceInit.tb_lb_hidden_editor),d.menubar=!1,d.inline=!0,d.skin=!1,d.target=b[0],d.theme=!1,d.plugins="lists",d.toolbar1=null,d.toolbar2=null,d.selector=!1,d.body_class=!1,d.content_css=null,d.external_plugins=null,d.wp_shortcut_labels=!1,d.branding=!1,d.auto_focus=!1,d.hidden_input=!1,d.setup=function(d){c.tinymce=d;d.on("init",function(){if(l){z=!1;var f=b.offset()}else if(t){f=d.dom.select("#tb_editor_carret")[0];d.selection.select(f,!0);if(m.getSelection&&
h.modify)h.collapseToStart(),h.modify("move","backward","word"),h.modify("extend","forward","word");else if((h=k.selection)&&"Control"!==h.type){var g=h.createRange();g.collapse(!0);g.expand("word")}f=e(f).offset();t=null}f&&(a.pageX=f.left,a.pageY=f.top);d.focus();c._setSelectedButtons();c._setCarret(a);b.on("mousedown selectstart",c.selectStart);d.on("Undo Redo",c._setSelectedButtons.bind(c))})},m.tinymce.init(d)):(c.toolbar.removeClass("tb_show").hide(),c.reset());b.one("keydown",function(){A=
!0});Themify.body[0].classList.add("tb_editor_active");e(k).off("click",c.disable).on("click",c.disable);"desktop"===g.activeBreakPoint&&g.Mixins.Builder.updateModuleSort(null,"disable")}else f.find(".themify_module_options").first().trigger("click")},z?1:250);++B}},remove:function(){this.save();g.undoManager.updateUndoBtns();if(this.tinymce){var a=this.tinymce.targetElm;tinymce.EditorManager.execCommand("mceRemoveEditor",!0,this.tinymce.id);a.setAttribute("contenteditable","false");this.tinymce.id===
e(a).off("mousedown selectstart",this.selectStart).off("keyup",this._selection).prop("id")&&a.removeAttribute("id");this.tinymce=null}},disable:function(a){if(!v){var b=TB_InlineEdit;if(!a||!b.toolbar[0].contains(a.target)){b.is_active=C=F=null;b.reset();B=0;Themify.body[0].classList.remove("tb_editor_active");e(".tb_editor_on").removeClass("tb_editor_on");b.toolbar.removeClass("tb_show").hide();b.remove();"desktop"===g.activeBreakPoint&&g.Mixins.Builder.updateModuleSort(null,"enable");e(k).off("click",
b.disable);e(".themify_builder_content").find('[contenteditable="true"]').prop("contenteditable","false");if(q&&"off"!==q.data("auto-scroll")){if(w){a=0;for(var c=w.length;a<c;++a)q.bind("mousedown",w[a].handler)}q.trigger("resume")}e("#tb_editor_carret").remove();G(b.el);b.el=D=q=w=y=null}}v=null},_setCarret:function(a){var b=TB_InlineEdit;!v&&a&&(y=a.pageY);var c=b.tinymce.selection?b.tinymce.selection.getRng().getBoundingClientRect():null;a=c?c.left+c.width/2:a.pageX;var c=b.toolbar.height(),f=
b.toolbar.width(),d=e(m).width();a-=f/2;0>a?a=15:a+f>=d&&(a=d-1-f);c=y-c-40;0>c&&(c=15);b.toolbar.css({top:c,left:a});b.toolbar[0].classList.contains("tb_show")||b.toolbar.show()[0].classList.add("tb_show")},_selection:function(a){TB_InlineEdit._setSelectedButtons();TB_InlineEdit._setCarret(a)},_setSelectedButtons:function(){var a=!1;null===x&&(x=this.toolbar[0].getElementsByClassName("tb_editor_action"),r=[],a=!0);for(var b=0,c=x.length;b<c;++b){var f=x[b].dataset.action;if("top"!==f){var d=x[b].dataset.type,
h=e(x[b]),g=h.closest("li");d||(d=h.closest("ul").data("type"));g[0].classList.remove("tb_selected");this._actions[d].state?this._actions[d].state(f,h):this.state(d)&&g[0].classList.add("tb_selected")}else a&&r.push(x[b])}b=0;for(c=r.length;b<c;++b){for(var a=r[b].getElementsByClassName("tb_selected"),f=r[b].classList,l,d=0,h=f.length;d<h;++d)if(0===f[d].indexOf("ti-")){r[b].classList.remove(f[d]);break}if(0<a.length)for(f=a[0].classList,d=0,h=f.length;d<h;++d){if(0===f[d].indexOf("ti-")){l=f[d];
break}}else l=r[b].dataset["default"],e(r[b]).find(".tb_editor_selected_text").remove();l?r[b].classList.add(l):0<a.length&&(f=r[b].getElementsByClassName("tb_editor_selected_text"),a=a[0].getElementsByTagName("button")[0].dataset.action,0<f.length?f[0].innerHTML=a:r[b].insertAdjacentHTML("afterbegin",'<span class="tb_editor_selected_text">'+a+"</span>"))}},_actionClicked:function(a){a.preventDefault();a.stopImmediatePropagation();var b=TB_InlineEdit;if(0===e(this).closest(".tb_editor_active_tab").length){var c=
e(this);var f=c.data("type"),d=c.data("action");if("top"===d){a=c.find("ul");var h=a.find(".tb_selected").next();if(0===h.length||h[0].classList.contains("ti-control-skip-forward")||h[0].classList.contains("ti-control-skip-backward"))h=a.find("li").first();h.find(".tb_editor_action").trigger("click")}else{f||(a=e(this).closest("ul"),f=a.data("type"));var g=b.toolbar.find("#tb_editor_"+f+"_wrapper"),l=function(){"expand"!==f&&(A=!0);C=f;b._actions[f].result(d,c,g);"expand"!==f&&(b._setSelectedButtons(),
0<g.length&&b._setCarret())};0<g.length?(b.reset(),b._setCarret(),b.toolbar.one("transitionend",function(){e(this).one("transitionend",function(){g[0].classList.add("tb_editor_active_tab");setTimeout(l,15)})[0].classList.add("tb_show");b._close()})[0].classList.remove("tb_show")):l()}}},reset:function(){var a=this.toolbar.find(".tb_editor_active_tab");0<a.length&&a[0].classList.remove("tb_editor_active_tab")},exec:function(a){var b=1<arguments.length&&arguments[1]!==p?arguments[1]:null;g.hasChanged=
!0;(this.tinymce||k).execCommand(a,!1,b)},state:function(a){a=this.tinymce.queryCommandState(a);return-1===a?!1:a},_close:function(){this.toolbar.one("click",".ti-close",function(a){a.preventDefault();a.stopPropagation();TB_InlineEdit.reset();TB_InlineEdit._actions.link.state();TB_InlineEdit._setCarret();C=!1})},_actions:{bold:{result:function(a,b){return TB_InlineEdit.exec("bold")}},text_align:{result:function(a,b){return TB_InlineEdit.exec(a)},state:function(a,b){TB_InlineEdit.state(a)&&b.closest("li")[0].classList.add("tb_selected")}},
underline:{result:function(a,b){return TB_InlineEdit.exec("underline")}},paragraph:{result:function(a,b){return TB_InlineEdit.exec("formatBlock",a)},state:function(a,b){0<e(m.getSelection().focusNode).closest(a).length&&b.closest("li")[0].classList.add("tb_selected")}},list:{result:function(a,b){return TB_InlineEdit.exec(a)},state:function(a,b){"Indent"!==a&&"Outdent"!==a&&!0===TB_InlineEdit.state(a)&&b.closest("li")[0].classList.add("tb_selected")}},italic:{result:function(a,b){return TB_InlineEdit.exec("italic")}},
link:{loaded:null,result:function(a,b,c){var f=TB_InlineEdit,d=this;a=f.toolbar;var h=c.find(".ti-angle-double-up"),t=h.next(".tb_editor_link_options").hide(),l=t.find("#tb_editor_link_type"),n=c.find(".tb_link_input"),k=function(a){if("keydown"!==a.type||13===a.which)if(a.preventDefault(),a.stopImmediatePropagation(),a=e.trim(n.val())){n.off("keydown",k);var b={href:a};if(h.hasClass("ti-angle-double-down")){var c=l.val();if("lightbox"===c){var u=t.find("#tb_editor_lightbox_w");a=t.find("#tb_editor_lightbox_h");
if(0<u.val()||0<a.val()){if(0<u.val()){var m=u.next().find("select").val();b["data-w"]=+u.val()+("px"===m?"":m)}0<a.val()&&(m=a.next().find("select").val(),b["data-h"]=+a.val()+("px"===m?"":m))}}}"blank"===c?b.target="_blank":"lightbox"===c&&(b["class"]="themify_lightbox");f.exec("mceInsertLink",b);f.reset();d.state();g.hasChanged=!0;n.val("");f._setCarret()}};n.off("keydown",k).on("keydown",k);h.off("click").on("click",function(a){a.preventDefault();a.stopPropagation();t.one("transitionend",function(){f._setCarret()});
e(this).toggleClass("ti-angle-double-down")});a.one("click",".ti-check",k);var u=t.find(".tb_editor_lightbox_actions").css("display","");l.off("change").on("change",function(a){u.one("transitionend",function(){f._setCarret()}).css("display","").toggleClass("tb_editor_lightbox_actions_open","lightbox"===e(this).val());f._setCarret()});if(n.val()){if(c=e(f.tinymce.selection.getNode()).closest("a"),0<c.length){var m=c[0].classList.contains("themify_lightbox");var p=!m&&"_blank"===c.prop("target");c=
null}}else l.val("");m||p?(u.addClass("tb_editor_lightbox_actions_open"),h.addClass("ti-angle-double-down")):(u.removeClass("tb_editor_lightbox_actions_open"),h.removeClass("ti-angle-double-down"));t.css("display","");f._setCarret();n.focus()},state:function(a,b){var c=TB_InlineEdit,f="",d=c.tinymce.selection.getNode();"A"===d.nodeName&&(f=d.getAttribute("href"),c.toolbar.find("#tb_editor_link_wrapper")[0].classList.contains("tb_editor_active_tab")||(E.addClass("tb_editor_active_tab").find("a").prop("href",
f),E.one("click",".ti-unlink",function(a){a.preventDefault();a.stopImmediatePropagation();c.exec("unlink");c.reset()}).find(".tb_editor_link_value button").text(f).one("click",function(a){a.preventDefault();a.stopImmediatePropagation();c.toolbar.find(".tb_link_input").val(f);c.reset();e(".tb_editor_action",e(".tb_editor_link",c.toolbar)).trigger("click")})));c.toolbar.find(".tb_link_input").val(f);var h=c.toolbar.find("#tb_editor_link_type"),g="",l=c.toolbar.find(".tb_editor_lightbox_actions");if(""!==
f){d.classList.contains("themify_lightbox")?(g="lightbox",l.show()):"_blank"===d.target&&(g="blank");if("lightbox"!==g)c.toolbar.find("#tb_editor_lightbox_w,#tb_editor_lightbox_h").val(""),l.hide();else for(var l=["w","h"],n=0;2>n;++n){var k=d.dataset[l[n]],u=e("#tb_editor_lightbox_"+l[n]+"_unit");if(k){var m=parseFloat(k);if(!m||0>m)m="";u.val(-1!==k.indexOf("%")?"%":"");c.toolbar.find("#tb_editor_lightbox_"+l[n]).val(m)}else u.val("")}h.val(g)}else E.hasClass("tb_editor_active_tab")&&(E.removeClass("tb_editor_active_tab"),
c.toolbar.find("#tb_editor_lightbox_w,#tb_editor_lightbox_h").val(""));return""!==f}},color:{input:null,is_trigger:!1,result:function(a,b,c){var f=TB_InlineEdit;if(!this.input){a=e('link[href*="jquery.minicolors.css"]',top_iframe).prop("href");Themify.LoadCss(a,!1);g.Utils.setColorPicker(c);this.input=c.find(".minicolors-input");var d=this.input.prop("id"),h=this,k=!1;Themify.body.on("themify_builder_color_picker_change",function(a,b,c,e){d!==b||""===e||h.is_trigger||(f.exec("foreColor",e),g.hasChanged=
!0,k&&(k=!1,this.input.focus()));h.is_trigger=!1});this.input.on("mousedown",function(a){k=!0}).next(".minicolors-swatch").trigger("click")}},state:function(){if("color"===C&&this.input){var a=TB_InlineEdit.tinymce.queryCommandValue("foreColor");""!==a&&!1!==a&&(this.is_trigger=!0,this.input.minicolors("value",a))}}},fonts:{loaded:null,getValue:function(a,b,c){for(;b.parentNode.id!==TB_InlineEdit.tinymce.id;){if(b.style[a])return c&&(b.style[a]=""),b.style[a];b=b.parentNode}return!1},result:function(a,
b,c){if(!this.loaded){var f=TB_InlineEdit,d=!1;themifyBuilder.fonts?(a=themifyBuilder.fonts.safe,b=themifyBuilder.fonts.google,d=!0):(a=ThemifyBuilderCommon.safe_fonts,b=ThemifyBuilderCommon.google_fonts);this.loaded=c;var h=c.find("#tb_editor_font_select optgroup");c=c.find(".tb_range");var m=this,l="",n;for(n in a)if(!d||1<n)l+='<option value="'+(d?a[n].value:n).replace(/\'/g,"")+'">'+(d?a[n].name:a[n])+"</option>";h[0].innerHTML=l;l="";for(n in b)if(!d||1<n)l+='<option value="'+(d?b[n].value:n)+
'">'+(d?b[n].name:b[n])+"</option>";h.last()[0].innerHTML=l;h.first().closest("select").change(function(a){a=e.trim(e(this).val());"google"===e(this).find('[value="'+a+'"]').closest("optgroup").data("type")&&ThemifyBuilderCommon.loadGoogleFonts(a);f.exec("fontName",a)});c.each(function(){var a=e(this).next().find(".tb_unit")[0],b=e(this).prop("id"),c="tb_editor_font_size"===b,d=!1,h="tb_editor_line_height"===b?"line-height":"letter-spacing",l;e(this).keyup(function(g){var k=this;l&&clearTimeout(l);
l=setTimeout(function(){var g=k.value;if(""!==g)if(g+=a.value,c)f.exec("fontSize",g);else{var l={};l[h]=g;tinymce.activeEditor.formatter.register(b,{inline:"span",styles:l});f.tinymce.formatter.apply(b)}else m.getValue(c?"fontSize":"tb_editor_line_height"===b?"lineHeight":"letterSpacing",f.tinymce.selection.getNode(),!0);d&&(d=!1,e(k).focus())},8)}).focus(function(){d=!0});g.Utils.createRange(e(this),k)})}},state:function(){if(this.loaded&&"fonts"===C){var a=TB_InlineEdit,b=a.tinymce.queryCommandValue("fontName"),
c=a.toolbar.find("#tb_editor_font_select");if(b){for(var f=c[0].getElementsByTagName("option"),d=!1,b=b.replace(/\"/g,""),g=0,k=f.length;g<k;++g)if(f[g].value===b){d=f[g].selected=!0;break}d||(b=!1,c.val(""))}else c.val("");var l=this,m=a.tinymce.selection.getNode();this.loaded.find(".tb_range").each(function(){var b=this.id,c=l.getValue("tb_editor_font_size"===b?"fontSize":"tb_editor_line_height"===b?"lineHeight":"letterSpacing",m),d="px";!1===c?c="":(d=-1!==c.indexOf("em")?"em":-1!==c.indexOf("%")?
"%":"px",c=parseFloat(c));a.toolbar.find("#"+b+"_unit").val(d);e(this).val(c)});return b}}},expand:{result:function(a,b,c){TB_InlineEdit.save();TB_InlineEdit.disable();TB_InlineEdit.el.closest(".active_module").find(".themify_module_options").first().trigger("click")}}},save:function(){if(A&&this.el){e("#tb_editor_carret").remove();var a=this.el.closest(".active_module").data("cid"),b=this.tinymce?this.tinymce.getContent():this.el[0].innerText,c=g.Models.Registry.lookup(a),f=this.el.data("name"),
d=this.el.data("repeat");c&&f&&(c=c.get("mod_settings"),d!==p?c[d]&&(c[d][this.el.data("index")][f]=b):c[f]=b,g.Models.setValue(a,c,!0))}}}})(jQuery,window,document,tb_app);
